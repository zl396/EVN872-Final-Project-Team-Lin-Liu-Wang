---
title: "Will the 100% clean energy commitment be on time?"
author: "Zhenghao Lin, Chenjia Liu, Shuyi Wang"
output: pdf_document
subtitle: https://github.com/zl396/EVN872-Final-Project-Team-Lin-Liu-Wang
date: "Fall 2023"
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}

# Set your working directory
library(here)
here()

# Load your packages
library(rlist)
library(tidyverse)
library(dplyr)
library(lubridate)
library(here)
library(trend)
library(tseries)
library(forecast)
library(gridExtra)
# Set your working directory
here()
# Set your ggplot theme
mytheme <- theme_bw()+
  theme(plot.title = element_text(hjust=0.5),
  plot.subtitle =element_text(hjust=0.5),
  text=element_text(size=12, family='sans'),
  panel.grid.minor = element_blank(),
  panel.grid.major = element_blank())
# Load your datasets
# Import data set and drop first 4 rows
Michigan_raw<- read.csv(file=here("Data/Michigan_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Minnesota_raw<- read.csv(file=here("Data/Minnesota_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Nevada_raw<- read.csv(file=here("Data/Nevada_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
New_Mexico_raw<- read.csv(file=here("Data/New_Mexico_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
California_raw<- read.csv(file=here("Data/California_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Connecticut_raw<- read.csv(file=here("Data/Connecticut_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Illinois_raw<- read.csv(file=here("Data/Illinois_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Maine_raw<- read.csv(file=here("Data/Maine_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
New_York_raw<- read.csv(file=here("Data/New_York_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Oregon_raw<- read.csv(file=here("Data/Oregon_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Virginia_raw<- read.csv(file=here("Data/Virginia_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
Washington_raw<- read.csv(file=here("Data/Washington_Net_generation_for_all_sectors.csv"),
           stringsAsFactors = TRUE, skip=4)
# Remove the first 4 rows with no useful information
# Transpose the dataframe
# Convert to a data frame and set column names
# Drop the first 3 rows and repeated columns
# Generate sequence of dates starting from January 2001
# Add a 'State' column indicating 'Michigan'
# Rename columns for clarity
Michigan <- Michigan_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Michigan")

Minnesota <- Minnesota_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Minnesota")

Nevada <- Nevada_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Nevada")

New_Mexico <- New_Mexico_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "New_Mexico")

California <- California_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "California")

Connecticut <- Connecticut_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Connecticut")

Illinois <- Illinois_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Illinois")

Maine <- Maine_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Maine")

New_York <- New_York_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "New_York")

Oregon <- Oregon_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Oregon")

Virginia <- Virginia_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Virginia")

Washington <- Washington_raw %>%
  slice(-c(1:4)) %>%
  t() %>%
  as.data.frame(stringsAsFactors = FALSE) %>%
  setNames(.[1, ]) %>%
  .[-c(1:3), ] %>%
  select(-c(11:13)) %>%
  mutate(Date = seq(as.Date("2001-01-01"), by = "1 month", length.out = nrow(.)),
         State = "Washington")
#build a function to change the name of columns
set_column_names <- function(data) {
  names(data) <- c(
    "All fuels",
    "coal",
    "petroleum liquids",
    "petroleum coke",
    "natural gas",
    "other gases",
    "nuclear",
    "conventional hydroelectric",
    "other renewables",
    "other renewables:wind",
    "other renewables:geothermal",
    "other renewables:biomass",
    "biomass:wood and wood-derived fuels",
    "biomass:other biomass",
    "hydro-electric pumped storage",
    "other",
    "all solar",
    "small-scale solar photovoltaic",
    "all utility-scale solar",
    "all utility-scale solar:utility-scale photovoltaic",
    "all utility-scale solar:utility-scale thermal",
    "Date",
    "State"
  )
  rownames(data) <- seq_len(nrow(data))
  return(data)
}
#Rename columns
Michigan <- set_column_names(Michigan)
Minnesota <- set_column_names(Minnesota)
Nevada <- set_column_names(Nevada)
New_Mexico <- set_column_names(New_Mexico)
California <- set_column_names(California)
Connecticut <- set_column_names(Connecticut)
Illinois <- set_column_names(Illinois)
Maine <- set_column_names(Maine)
New_York <- set_column_names(New_York)
Oregon <- set_column_names(Oregon)
Virginia <- set_column_names(Virginia)
Washington <- set_column_names(Washington)
#Build a function to convert columns to numeric
convert_columns_to_numeric <- function(data) {
  columns_to_convert <- 1:(ncol(data) - 2)
  data[, columns_to_convert] <- apply(data[, columns_to_convert], 2, as.numeric)
  return(data)
}
#Convert to numeric
Michigan <- convert_columns_to_numeric(Michigan)
Minnesota <- convert_columns_to_numeric(Minnesota)
Nevada <- convert_columns_to_numeric(Nevada)
New_Mexico <- convert_columns_to_numeric(New_Mexico)
California <- convert_columns_to_numeric(California)
Connecticut <- convert_columns_to_numeric(Connecticut)
Illinois <- convert_columns_to_numeric(Illinois)
Maine <- convert_columns_to_numeric(Maine)
New_York <- convert_columns_to_numeric(New_York)
Oregon <- convert_columns_to_numeric(Oregon)
Virginia <- convert_columns_to_numeric(Virginia)
Washington <- convert_columns_to_numeric(Washington)
#Generate a dataframe with all states
combined_df <- rbind(Michigan, Minnesota, Nevada, New_Mexico, California, Connecticut,  Illinois, Maine,New_York, Oregon, Virginia, Washington)
```

# Rationale and Research Questions
## Introduction
In addition to the”Renewable Energy Portfolios” (RPS) that requires certain percentages of energy to be generated from renewable energy sources, many states have enacted “Clean Energy Standards” (CES) that separates clean energy sources that are carbon-free or carbon-neutral from renewable sources which may generate carbon emissions (2021). Under CES, clean energy sources include nuclear, hydropower, solar power, wind, and other renewables. Most CES would include RPS as a part of the policy. 

Currently, there are 12 states that have established 100% Clean energy goals though their times vary. In this analysis, we are interested in whether those states are able able to meet their clean energy commitments by the planned years under current development. The objective is to understand the clean energy development trends in different states in the past and the future, and which states should accelerate their clean energy transitions more rapidly than others. Therefore, the electricity generation data for each of the 12 states from EIA are chosen for the quantitative analysis. Our research questions revolves around the comparison between the growth of clean energy generation versus the growth of total energy generation in the 12 states. 

## Research Questions
1. What would the trend of clean energy generation be until the commitment years for each of the 12 states? 
2. What would the trend of total energy generation be until the commitment years for each of the 12 states?
3. How does the clean energy generation growth compare to the total energy generation growth? (Does clean eenrgy generation meet total energy generation?)

\newpage

# Dataset Information
All datasets used in this analysis were obtained from the U.S. Energy Information Administration (EIA) website, utilizing the ELECTRICITY DATA BROWSER. The data comprises monthly net electricity generation across twelve states committed to achieving 100% carbon-free electricity in the near future. Specifically, it includes net generation figures for coal, petroleum liquids, petroleum coke, natural gas, other gases, nuclear, conventional hydroelectric, wind, geothermal, biomass, wood and wood-derived fuels, hydro-electric pumped storage, small-scale solar photovoltaic, utility-scale photovoltaic, and utility-scale thermal sources from January 2001 to August 2023.

# Dataset Wrangling 
The datasets for each state are downloaded and processed separately. Upon importing the data into R, a function is developed to eliminate extraneous information. The initial four descriptive rows, which don't contribute to the analysis, are removed. The raw data organizes dates in columns and net generation by sectors in rows. To facilitate analysis, the dataset is transposed. This transposed data is converted into a data frame, ensuring that columns remain as intended and are not converted into factors. Column names are set based on the first row of transposed data.

Following this, rows 2 to 4 (containing unnecessary information) are removed. Additionally, columns 11 to 13, representing 'All-utility scale solar' under the subset of other renewable sectors, are excluded. This step is necessary to prevent double counting since there's an independent sector for all solar.

A new 'Date' column is created, starting from January 1, 2001, incremented by one month, and ending based on the dataset's row count. Simultaneously, a 'State' column is added, assigning the respective state name to each row. Column names are then refined for better clarity using a dedicated function.

Furthermore, a function is designed to convert all columns, excluding the last two (date and state), to a numeric format. Finally, a new data frame encompassing data from the 12 states is generated by merging the individual datasets based on the state name. The following table presents the processed data structure.

```{r echo=FALSE}
EIA_data_summary<-data.frame(
  Column_name=c("All fuels",
    "coal",
    "petroleum liquids",
    "petroleum coke",
    "natural gas",
    "other gases",
    "nuclear",
    "conventional hydroelectric",
    "other renewables",
    "other renewables:wind",
    "other renewables:geothermal",
    "other renewables:biomass",
    "biomass:wood and wood-derived fuels",
    "biomass:other biomass",
    "hydro-electric pumped storage",
    "other",
    "all solar",
    "small-scale solar photovoltaic",
    "all utility-scale solar",
    "all utility-scale solar:utility-scale photovoltaic",
    "all utility-scale solar:utility-scale thermal",
    "Date",
    "State"),
  Unit=c("thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "thousand megawatthours",
         "day-month-year",
         "Michigan, Minnesota, Nevada, New_Mexico, California, Connecticut,  Illinois, Maine, New_York, Oregon, Virginia, Washington")
)
knitr::kable(EIA_data_summary,caption = "Table summarizing the dataset structure")
```


\newpage

# Exploratory Analysis 
In this exploratory analysis, we will investigate the net generation data of clean energy and total electricity generation across 12 states. Our objective is to examine whether these time series datasets exhibit any obvious trends or seasonality patterns from January 2001 to August 2023. Here we will first generate the graphs of both clean energy and total electricity generation to observe any obvious trend, then decompose the graphes to see more detailed trend and seasonality display. We will also use Augmented Dickey Fuller test to find out whether the graph is stationary so that we can continue our projection process. Understanding these patterns is crucial as they can significantly impact the accuracy of our future forecasts.

```{r funtioncs, echo=FALSE}
csvs <- list.files(path = here('Processed'),pattern = "\\.csv$", full.names = TRUE)

file_name <- c('California','combined_df', 'Connecticut', 
               'Illinois', 'Maine', 'Michigan', 'Minnesota', 
               'Nevada', 'New_Mexico', 'New_York', 
               'Oregon', 'Virginia', 'Washington')

names(csvs) <- file_name

#create a function that read csv files
csv_reader <- function(state_name) {
  file_i <- read.csv(csvs[[state_name]], stringsAsFactors = TRUE)
}

# create a function that wrangles data, add a column for total energy generations
data_all <- function(state_name){
  state_data <- csv_reader(state_name) %>% 
    mutate(Date = ymd(Date)) %>% 
    replace(is.na(.),0) %>%
    select(All.fuels, Date)
}

data_clean <- function(state_name){
  state_data <- csv_reader(state_name) %>% 
    mutate(Date = ymd(Date)) %>% 
    replace(is.na(.),0) %>% 
    mutate(clean_energy = nuclear+
          conventional.hydroelectric+
          other.renewables+
          hydro.electric.pumped.storage+
          other) %>%
    select(clean_energy, Date)
  }

# Create a function that plots energy generation percentages  
plot_clean <- function(state_name){ggplot(data_clean(state_name), 
                                            aes(x=Date, y=clean_energy))+
    geom_line(color='lightgreen')+
    geom_smooth(method = 'loess', color='brown')+
    scale_x_date(breaks=scales::breaks_pretty(10))+
    scale_y_continuous(breaks=scales::breaks_pretty(10))+
    labs(y= 'Clean Energy Generation (MWh)', x='Date', title='Clean Energy Generation (MWh)', subtitle = paste(state_name,'(2001.1-2023.8)'))+
    mytheme
  }
  
  

plot_all <- function(state_name){ggplot(data_all(state_name), 
                                            aes(x=Date, y=All.fuels))+
    geom_line(color='darkslategray3')+
    geom_smooth(method = 'loess', color='coral')+
    scale_x_date(breaks=scales::breaks_pretty(10))+
    scale_y_continuous(breaks=scales::breaks_pretty(10))+
    labs(y= 'All Fuels', x='Date', title='All Fuels', subtitle = paste(state_name,'(2001.1-2023.8)'))+
    mytheme
}

decomp.plot <- function(x, main, ...)
{
    if(missing(main))
	main <- paste("Decomposition of", x$type, "time series")
    plot(cbind(observed = x$random + if (x$type == "additive")
        x$trend + x$seasonal
    else x$trend * x$seasonal, trend = x$trend, seasonal = x$seasonal,
        random = x$random), main = main, ...)
}
```

## California

Below are the plots of clean energy and total electricity generation of state California. we can see that both plots are experiencing a concave-down curve before 2012 and an increase after. However, the increasing trend of clean energy electricity generation after 2012 is way stronger than the total generation one.
```{r, EA CA, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State California, 01/2001~08/2023'}
california <- csv_reader('California')

#CA clean energy
CA.clean <- data_clean('California')
#CA.clean graph
plot.clean.ca <- plot_clean('California')

#CA.all
CA.all <-data_all('California')
#CA.all graph
plot.all.ca <- plot_all("California")

combined.plot.ca <- grid.arrange(plot.clean.ca, plot.all.ca, ncol = 2)
```

Following the plots are the graph of the decomposed clean energy and total electricity generation time series dataset. From both graphs, while the trend now is not very clear, we can observe obvious seasonality, thus we may need to perform AD-Fuller test to see whether both time series are stationary to perform forecasts.
```{r, echo=FALSE, fig.align='center', fig.width= 10, fig.cap='Decomposition, Clean Energy, California'}
#CA.clean TS
CA.clean.ts <- ts(CA.clean$clean_energy, start = c(2001,1),frequency = 12)
decompose.clean.ca <- decompose(CA.clean.ts)
decomp.plot(decompose.clean.ca, main = 'Decomposition of time series of clean energy electricity generation in CA')
```

\newpage

```{r, echo=FALSE, fig.align='center', fig.width= 10, fig.cap='Decomposition, All Fuels, California'}
#CA.all TS
CA.all.ts <- ts(CA.all$All.fuels, start = c(2001,1),frequency = 12)
decompose.all.ca <- decompose(CA.all.ts)
decomp.plot(decompose.all.ca, main = 'Decomposition of time series of total electricity generation in CA')
```

The results of both time series for state California is listed as follow: 
```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(CA.clean.ts, alternative="stationary", k=0)
adf.test(CA.all.ts, alternative="stationary", k=0)
```
From the tests, we can tell that the p-values of both data are smaller than the signifance level, indicating that both data are stationary.

\newpage

## Connecticut

Below are the plots of clean energy and total electricity generation of state Connecticut. While the clean energy generation in the past two decades has stayed at the same level, there is an clear increase for the all fuel electricity generation plots.
```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Connecticut, 01/2001~08/2023'}
connecticut <- csv_reader('Connecticut')

# CT clean energy
CT.clean <- data_clean('Connecticut')
# CT clean graph
plot.clean.ct<-plot_clean('Connecticut')

# CT all
CT.all <- data_all('Connecticut')
# CT all graph
plot.all.ct<-plot_all("Connecticut")

combined.plot.ct <- grid.arrange(plot.clean.ct, plot.all.ct, ncol = 2)
```

Following the plots are the graph of the decomposed clean energy and total electricity generation time series dataset. From both graphs, while we only observe trend for the total generation graph, there exist obvious seasonality, thus we may need to perform AD-Fuller test to see whether both time series are stationary to perform forecasts.
```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Connecticut'}
# CT clean TS
CT.clean.ts <- ts(CT.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.ct <- decompose(CT.clean.ts)
decomp.plot(decompose.clean.ct, main = 'Decomposition of time series of clean energy electricity generation in CT')
```

\newpage

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, All Fuels, Connecticut'}
# CT all TS
CT.all.ts <- ts(CT.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.ct <- decompose(CT.all.ts)
decomp.plot(decompose.all.ct,'Decomposition of time series of total electricity generation in CT')
```

The results of both time series for state Connecticut are listed as follow: 
```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(CT.clean.ts, alternative="stationary", k=0)
adf.test(CT.all.ts, alternative="stationary", k=0)
```
From the tests, we can tell that the p-values of both data are smaller than the signifance level, indicating that both data are stationary.

\newpage

## Illinois
For state Illinois, while its total electricity generation was increasing before 2012 and went downward since then, it's electricity generation from clean energy is always going upward in the past two decades. What's more, both plots seem to exhibit seasonality. We now need to take a closer to by decomposing the two time series data to confirm our observations.
```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Illinois, 01/2001~08/2023'}
illinois <- csv_reader('Illinois')

# IL clean energy
IL.clean <- data_clean('Illinois')
# IL clean graph
plot.clean.il <- plot_clean('Illinois')

# IL all
IL.all <- data_all('Illinois')
# IL all graph
plot.all.il <- plot_all("Illinois")

combined.plot.il <- grid.arrange(plot.clean.il, plot.all.il, ncol = 2)
```

Below are the graphs of the decompose of two time series data. From both graphs we can actually see a upward trend and seasonality. We need to perform AD-Fuller test to see whether both graphs are stationary so that we can peform a more accurate forecast.
```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Illinois'}
# IL clean TS
IL.clean.ts <- ts(IL.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.il <- decompose(IL.clean.ts)
decomp.plot(decompose.clean.il, main = 'Decomposition of time series of clean energy electricity generation in IL')
```
\newpage
```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, All Fuels, Illinois'}
# IL all TS
IL.all.ts <- ts(IL.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.il <- decompose(IL.all.ts)
decomp.plot(decompose.clean.il, main = 'Decomposition of time series of total energy electricity generation in IL')
```
The results of both time series for state Illinois is listed as follow: 
```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(IL.clean.ts, alternative="stationary", k=0)
adf.test(IL.all.ts, alternative="stationary", k=0)
```
From the tests, we can tell that the p-values of both data are smaller than the signifance level, indicating that both data are stationary.

## Summary of Exploratory Analysis
Above are the plots and results of three states that we randomly chose as example to perform the exploratory analysis.
For the purpose of conciseness of our analysis, we will put the results of the rest 9 states in the Appendix page at the end. 
For the rest 9 states, while trend varies with state and fuels for electricity generation, they all exhibit strong seasonality. However, when performing AD-Fuller tests under all the scenarios, all of the p-values are below significant level, thus indicating stationarity. 

\newpage

# Analysis 
To compare the future trend of clean energy and total energy generation, we choose to use ARIMA model to forecast the future trends. The ARIMA model captures the patterns, seasonality, and trends of the data, which is particularly useful for forecasting future values that are correlated with past values. 
```{r time series, echo=FALSE}
# ts function
statets_clean <- function(state_name){
  state_data <- data_clean(state_name)
  f_month = month(first(state_data$Date))
  f_year = year(first(state_data$Date))
  clean.fuel.ts <- ts(
    state_data$clean_energy,
    start = c(f_year, f_month),
    frequency = 12)
  return(clean.fuel.ts)
}

statets_all <- function(state_name){
  state_data <- data_all(state_name)
  f_month = month(first(state_data$Date))
  f_year = year(first(state_data$Date))
  all.fuel.ts <- ts(
    state_data$All.fuels,
    start = c(f_year, f_month),
    frequency = 12)
  return(all.fuel.ts)
}

# create lists for result dataframe 
State <- c()
Forecasted.Year <- c()
All.Energy.Forecast <- c()
Clean.Energy.Forecast <- c()

#ARIMA forecasting
arima.all <- function(state_name,t){
  all.fuel.arima <- auto.arima(statets_all(state_name))
  all.fuel.forecast <- forecast(all.fuel.arima, level=c(95), h=t*12)
  last_date_forecast = 2023+t 
  plot <- autoplot(all.fuel.forecast)+
    labs(y= 'All Fuel', x='Date', title='All Fuel Forecast', subtitle = paste(state_name, paste('(2001 -',last_date_forecast, ')')))+
    mytheme
  last.forecast <- all.fuel.forecast$mean[length(all.fuel.forecast$mean)]
  State <- list.append(State, state_name)
  State <<- State
  Forecasted.Year <- list.append(Forecasted.Year, last_date_forecast)
  Forecasted.Year <<- Forecasted.Year
  All.Energy.Forecast <- list.append(All.Energy.Forecast, last.forecast)
  All.Energy.Forecast <<- All.Energy.Forecast
  print(plot)
}

arima.clean <- function(state_name,t){
  clean.arima <- auto.arima(statets_clean(state_name))
  clean.forecast <- forecast(clean.arima, level=c(95), h=t*12)
  plot <- autoplot(clean.forecast)+
    labs(y= 'Clean Energy Generation (MWh)', x='Date', title='Clean Energy Generation Forecast (MWh)', subtitle = paste(state_name,'(2001.1-2023.8)'))+
    mytheme
  last.forecast <- clean.forecast$mean[length(clean.forecast$mean)]
  Clean.Energy.Forecast <- list.append(Clean.Energy.Forecast, last.forecast)
  Clean.Energy.Forecast <<- Clean.Energy.Forecast
  print(plot)
}
```

## Question 1: What would the trend of clean energy generation be until the commitment years for each of the 12 states? 
The following line charts depicts the forecast trend of clean energy generation until each state's commitment year: 

### California 
```{r Clean Forecast California, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('California', 23)
```
### Connecticut 
```{r Clean Forecast Connecticut, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('Connecticut', 17)
```
### Illinois 
```{r Clean Forecast Illinois, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('Illinois', 27)
```
### Maine 
```{r Clean Forecast Maine, echo=FALSE, fig.align='center', fig.width=14}
arima.clean('Maine', 27)
```
### Michigan 
```{r Clean Forecast Michigan, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Michigan',17)
```
### Minnesota
```{r Clean Forecast Minnesota, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Minnesota',17)
```
### Nevada
```{r Clean Forecast Nevada, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Nevada',27)
```
### New Mexico
```{r Clean Forecast New Mexico, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('New_Mexico',22)
```
### New York 
```{r Clean Forecast New York, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('New_York',17)
```
### Oregon
```{r Clean Forecast Oregon, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Oregon',17)
```
### Virginia
```{r Clean Forecast Virginia, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Virginia',27)
```
### Washington
```{r Clean Forecast Washington, echo=FALSE, fig.align="center", fig.width = 14}
arima.clean('Washington',22)
```

## Question 2: What would the trend of total energy generation be until the commitment years for each of the 12 states?
The following line charts depicts the forecast trend of total energy generation until each state's commitment year: 
### California 
```{r All Forecast California, echo=FALSE, fig.align='center', fig.width=14}
arima.all('California', 23)
```
### Connecticut 
```{r All Forecast Connecticut, echo=FALSE, fig.align='center', fig.width=14}
arima.all('Connecticut', 17)
```
### Illinois 
```{r All Forecast Illinois, echo=FALSE, fig.align='center', fig.width=14}
arima.all('Illinois', 27)
```
### Maine 
```{r All Forecast Maine, echo=FALSE, fig.align='center', fig.width=14}
arima.all('Maine', 27)
```
### Michigan 
```{r All Forecast Michigan, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Michigan',17)
```
### Minnesota
```{r All Forecast Minnesota, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Minnesota',17)
```
### Nevada
```{r All Forecast Nevada, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Nevada',27)
```
### New Mexico
```{r All Forecast New Mexico, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('New_Mexico',22)
```
### New York 
```{r All Forecast New York, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('New_York',17)
```
### Oregon
```{r All Forecast Oregon, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Oregon',17)
```
### Virginia
```{r All Forecast Virginia, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Virginia',27)
```
### Washington
```{r All Forecast Washington, echo=FALSE, fig.align="center", fig.width = 14}
arima.all('Washington',22)
```

## Question 3: How does the clean energy generation growth compare to the total energy generation growth? (Does clean energy generation meet total energy generation?)
```{r Result, echo=FALSE}
#display result table 
result.df <- data.frame(State=State, 
                        Forecasted.Year=Forecasted.Year, 
                        Clean.Energy.Forecast=Clean.Energy.Forecast, 
                        All.Energy.Forecast=All.Energy.Forecast)

knitr::kable(result.df)
knitr::kable(result.df,caption = "Table summarizing the major results of 12 states' generation")
```

\newpage

# Summary and Conclusions
Out of the 12 states that have committed to 100% clean energy goals, only Maine is projected to be able to meet the goal. All other states will likely to fail to meet their commitments, though Illinois is close to meet the goal. 

# Limitations
There exists several limitations in our time series forecasts.
First, our analysis primarily relies on two single-variable time series forecasts: one for electricity generated by clean energy and another for total electricity generated. However, it's worth noting that these variables may exhibit correlations or dependencies that are not considered in our current approach. Future research could explore multivariate time series models to capture potential interactions and dependencies between different types of fuels, leading to more precise forecasts.
Second, clean energy has experienced different rates of development over the past two decades, with drastic growth in the past 10 years and more smooth increase in the first decade. This may introduce uncertainty into our forecasts, as past data may not fully reflect future trends. 
Last, our forecasts are based on historical data, which may not account for unforeseen factors that could emerge in the future and significantly impact the development of clean energy. As new technologies, policies, and global events unfold, they may alter the trajectory of clean energy generation. Therefore, our models may not capture the full range of potential influences on future outcomes.

\newpage

# Appendix
## Maine
```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Maine, 01/2001~08/2023'}
maine <- csv_reader('Maine')

# Maine clean energy
ME.clean <- data_clean('Maine')
# Maine clean graph
plot.clean.me <- plot_clean('Maine')

# Maine all
ME.all <- data_all('Maine')
# Maine all graph
plot.all.me <-plot_all("Maine")

combined.plot.me <- grid.arrange(plot.clean.me, plot.all.me, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Maine'}
# Maine clean TS
ME.clean.ts <- ts(ME.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.me <- decompose(ME.clean.ts)
decomp.plot(decompose.clean.me, main = 'Decomposition of time series of clean energy electricity generation in ME')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Maine'}
# Maine all TS
ME.all.ts <- ts(ME.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.me <- decompose(ME.all.ts)
decomp.plot(decompose.all.me,'Decomposition of time series of total electricity generation in ME')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(ME.clean.ts, alternative="stationary", k=0)
adf.test(ME.all.ts, alternative="stationary", k=0)
```
## Michigan
```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Michigan, 01/2001~08/2023'}
michigan <- csv_reader('Michigan')

# MI clean energy
MI.clean <- data_clean('Michigan')
# MI clean graph
plot.clean.mi <- plot_clean('Michigan')

# MI all
MI.all <- data_all('Michigan')
# MI all graph
plot.all.mi <-plot_all("Michigan")

combined.plot.mi <- grid.arrange(plot.clean.mi, plot.all.mi, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Michigan'}
# Michigan clean TS
MI.clean.ts <- ts(MI.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.mi <- decompose(MI.clean.ts)
decomp.plot(decompose.clean.mi, main = 'Decomposition of time series of clean energy electricity generation in MI')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Michigan'}
# Michigan all TS
MI.all.ts <- ts(MI.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.mi <- decompose(MI.all.ts)
decomp.plot(decompose.all.mi,'Decomposition of time series of total electricity generation in MI')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(MI.clean.ts, alternative="stationary", k=0)
adf.test(MI.all.ts, alternative="stationary", k=0)
```
## Minnesota
```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Minnesota, 01/2001~08/2023'}
minnesota <- csv_reader('Minnesota')

# MN clean energy
MN.clean <- data_clean('Minnesota')
# MI clean graph
plot.clean.mn <- plot_clean('Minnesota')

# MN all
MN.all <- data_all('Minnesota')
# MN all graph
plot.all.mn <-plot_all("Minnesota")

combined.plot.mn <- grid.arrange(plot.clean.mn, plot.all.mn, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Minnesota'}
# MN clean TS
MN.clean.ts <- ts(ME.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.mn <- decompose(MN.clean.ts)
decomp.plot(decompose.clean.mn, main = 'Decomposition of time series of clean energy electricity generation in MN')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Maine'}
# MN all TS
MN.all.ts <- ts(MN.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.mn <- decompose(MN.all.ts)
decomp.plot(decompose.all.mn,'Decomposition of time series of total electricity generation in MN')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(MN.clean.ts, alternative="stationary", k=0)
adf.test(MN.all.ts, alternative="stationary", k=0)
```

## Nevada
```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Nevada, 01/2001~08/2023'}
nevada <- csv_reader('Nevada')

# Nevada clean energy
NV.clean <- data_clean('Nevada')
# Nevada clean graph
plot.clean.nv <- plot_clean('Nevada')

# Nevada all
NV.all <- data_all('Nevada')
# Nevada all graph
plot.all.nv <-plot_all("Nevada")

combined.plot.nv <- grid.arrange(plot.clean.nv, plot.all.nv, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Nevada'}
# Nevada clean TS
NV.clean.ts <- ts(NV.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.NV <- decompose(NV.clean.ts)
decomp.plot(decompose.clean.NV, main = 'Decomposition of time series of clean energy electricity generation in NV')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Nevada'}
# Nevada all TS
NV.all.ts <- ts(NV.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.NV <- decompose(NV.all.ts)
decomp.plot(decompose.all.NV,'Decomposition of time series of total electricity generation in NV')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(NV.clean.ts, alternative="stationary", k=0)
adf.test(NV.all.ts, alternative="stationary", k=0)
```

## New Mexico

```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State New Mexico, 01/2001~08/2023'}
new_mexico <- csv_reader('New_Mexico')

# New_Mexico clean energy
NM.clean <- data_clean('New_Mexico')
# New_Mexico clean graph
plot.clean.nm <- plot_clean('New_Mexico')

# New_Mexico all
NM.all <- data_all('New_Mexico')
# New_Mexico all graph
plot.all.nm <-plot_all("New_Mexico")

combined.plot.nm <- grid.arrange(plot.clean.nm, plot.all.nm, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, New Mexico'}
# New_Mexico clean TS
NM.clean.ts <- ts(NM.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.nm <- decompose(NM.clean.ts)
decomp.plot(decompose.clean.nm, main = 'Decomposition of time series of clean energy electricity generation in NM')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, New Mexico'}
# New_Mexico all TS
NM.all.ts <- ts(NM.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.nm <- decompose(NM.all.ts)
decomp.plot(decompose.all.nm,'Decomposition of time series of total electricity generation in NM')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(NM.clean.ts, alternative="stationary", k=0)
adf.test(NM.all.ts, alternative="stationary", k=0)
```

## New York

```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State New York, 01/2001~08/2023'}
New_York <- csv_reader('New_York')

# New_York clean energy
NY.clean <- data_clean('New_York')
# New_York clean graph
plot.clean.ny <- plot_clean('New_York')

# New_York all
NY.all <- data_all('New_York')
# New_York all graph
plot.all.ny <-plot_all("New_York")

combined.plot.ny <- grid.arrange(plot.clean.ny, plot.all.ny, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, New York'}
# New_York clean TS
NY.clean.ts <- ts(NY.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.ny <- decompose(NY.clean.ts)
decomp.plot(decompose.clean.ny, main = 'Decomposition of time series of clean energy electricity generation in NY')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, New York'}
# New_York all TS
NY.all.ts <- ts(NY.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.ny <- decompose(NY.all.ts)
decomp.plot(decompose.all.ny,'Decomposition of time series of total electricity generation in NY')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(NY.clean.ts, alternative="stationary", k=0)
adf.test(NY.all.ts, alternative="stationary", k=0)
```

## Oregon

```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Oregon, 01/2001~08/2023'}
Oregon <- csv_reader('Oregon')

# Oregon clean energy
OR.clean <- data_clean('Oregon')
# Oregon clean graph
plot.clean.or <- plot_clean('Oregon')

# Oregon all
OR.all <- data_all('Oregon')
# Oregon all graph
plot.all.or <-plot_all("Oregon")

combined.plot.or <- grid.arrange(plot.clean.or, plot.all.or, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Oregon'}
# Oregon clean TS
OR.clean.ts <- ts(OR.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.or <- decompose(OR.clean.ts)
decomp.plot(decompose.clean.or, main = 'Decomposition of time series of clean energy electricity generation in OR')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Oregon'}
# Oregon all TS
OR.all.ts <- ts(OR.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.or <- decompose(OR.all.ts)
decomp.plot(decompose.all.or,'Decomposition of time series of total electricity generation in OR')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(OR.clean.ts, alternative="stationary", k=0)
adf.test(OR.all.ts, alternative="stationary", k=0)
```

## Virginia
```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Virginia, 01/2001~08/2023'}
Virginia <- csv_reader('Virginia')

# Virginia clean energy
VA.clean <- data_clean('Virginia')
# Virginia clean graph
plot.clean.va <- plot_clean('Virginia')

# Virginia all
VA.all <- data_all('Virginia')
# Virginia all graph
plot.all.va <-plot_all("Virginia")

combined.plot.va <- grid.arrange(plot.clean.va, plot.all.va, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Virginia'}
# Virginia clean TS
VA.clean.ts <- ts(VA.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.va <- decompose(VA.clean.ts)
decomp.plot(decompose.clean.va, main = 'Decomposition of time series of clean energy electricity generation in VA')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Virginia'}
# New_York all TS
VA.all.ts <- ts(VA.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.va <- decompose(VA.all.ts)
decomp.plot(decompose.all.va,'Decomposition of time series of total electricity generation in VA')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(VA.clean.ts, alternative="stationary", k=0)
adf.test(VA.all.ts, alternative="stationary", k=0)
```

## Washington

```{r, echo=FALSE, fig.align='center', fig.width= 14, message=FALSE, fig.cap='Clean Energy and Total Electricity Generation of State Washington, 01/2001~08/2023'}
Washington <- csv_reader('Washington')

# Washington clean energy
WA.clean <- data_clean('Washington')
# Washington clean graph
plot.clean.wa <- plot_clean('Washington')

# Washington all
WA.all <- data_all('Washington')
# Washington all graph
plot.all.wa <-plot_all("Washington")

combined.plot.wa <- grid.arrange(plot.clean.wa, plot.all.wa, ncol = 2)
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Washington'}
# Washington clean TS
WA.clean.ts <- ts(WA.clean$clean_energy, start = c(2001, 1), frequency = 12)
decompose.clean.wa <- decompose(WA.clean.ts)
decomp.plot(decompose.clean.wa, main = 'Decomposition of time series of clean energy electricity generation in WA')
```

```{r, echo=FALSE, fig.align='center', fig.width=10, fig.cap='Decomposition, Clean Energy, Washington'}
# Washington all TS
WA.all.ts <- ts(WA.all$All.fuels, start = c(2001, 1), frequency = 12)
decompose.all.wa <- decompose(WA.all.ts)
decomp.plot(decompose.all.wa,'Decomposition of time series of total electricity generation in WA')
```

```{r, echo = FALSE, warning=FALSE, fig.align='center'}
adf.test(WA.clean.ts, alternative="stationary", k=0)
adf.test(WA.all.ts, alternative="stationary", k=0)
```

\newpage

# References
Brief state renewable portfolio standards and goals. National Conference of State Legislatures. (2021, August 31). https://www.ncsl.org/energy/state-renewable-portfolio-standards-and-goals 
